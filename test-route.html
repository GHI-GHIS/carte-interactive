<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test Route</title>
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
  <style>
    body { margin: 0; padding: 20px; }
    #map { width: 100%; height: 500px; }
    button { padding: 10px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Test d'affichage de route</h1>
  <button onclick="showTestRoute()">Afficher trajet test</button>
  <button onclick="clearRoute()">Effacer trajet</button>
  <div id="map"></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZ2hpc2xhaW5sZXZyYXQiLCJhIjoiY2x0ZTRlYTFpMGM4ZTJrcGI1OWFsNXRjcSJ9.63vk7d4NVv3i75ozPADUbw';
    
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [2.2137, 46.2276],
      zoom: 6
    });

    async function showTestRoute() {
      console.log('Showing test route...');
      
      // Coordonnées de test : Paris vers Lyon
      const origin = [2.3522, 48.8566]; // Paris
      const destination = [4.8357, 45.7640]; // Lyon
      
      try {
        const coordinates = `${origin[0]},${origin[1]};${destination[0]},${destination[1]}`;
        const url = `https://api.mapbox.com/directions/v5/mapbox/driving/${coordinates}?geometries=geojson&overview=full&access_token=${mapboxgl.accessToken}`;
        
        console.log('Fetching from:', url);
        
        const response = await fetch(url);
        const data = await response.json();
        
        console.log('Response:', data);
        
        if (data.routes && data.routes[0]) {
          const route = data.routes[0];
          console.log('Route geometry:', route.geometry);
          
          // Effacer route précédente
          if (map.getSource('route')) {
            map.removeLayer('route');
            map.removeSource('route');
          }
          
          // Ajouter la route
          map.addSource('route', {
            'type': 'geojson',
            'data': route.geometry
          });
          
          map.addLayer({
            'id': 'route',
            'type': 'line',
            'source': 'route',
            'layout': {
              'line-join': 'round',
              'line-cap': 'round'
            },
            'paint': {
              'line-color': '#3887be',
              'line-width': 5,
              'line-opacity': 0.75
            }
          });
          
          // Centrer sur la route
          const bounds = new mapboxgl.LngLatBounds();
          route.geometry.coordinates.forEach(coord => bounds.extend(coord));
          map.fitBounds(bounds, { padding: 50 });
          
          console.log('Route added successfully!');
        }
        
      } catch (error) {
        console.error('Error:', error);
      }
    }
    
    function clearRoute() {
      if (map.getSource('route')) {
        map.removeLayer('route');
        map.removeSource('route');
        console.log('Route cleared');
      }
    }
  </script>
</body>
</html>