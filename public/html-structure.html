<div id="loading-overlay">Chargement de la carte...</div><div id="map-container"><div id="sidebar"><!-- Contenu du sidebar sans le mode switcher --><!-- Mode Normal Interface --><div id="normal-mode-interface" class="mode-interface"><div class="filter-section"><h2>Rechercher une ville ou UP</h2><div class="search-and-reset-container"><div id="normal-geocoder-container" class="search-container"><button id="normal-geolocate" class="geolocate-btn" title="Utiliser ma position"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg></button></div><button id="reset-map-inline" class="reset-map-inline">RÃ©initialiser</button></div></div></div><!-- Mode Route Interface --><div id="route-mode-interface" class="mode-interface" style="display:none;"><div class="filter-section"><h2>Calculer un itinÃ©raire</h2><button id="reset-map-route" class="reset-map-inline" style="margin-top: 0px; width: 100%;">RÃ©initialiser la carte</button><!-- Interface d'itinÃ©raire avec Points A et B --><div id="route-interface-container"><!-- Point A (origine) --><div class="route-point-section" id="point-a-section" style="position: relative;"><button id="add-destination-btn" class="add-point-btn" title="Ajouter une destination" style="position: absolute; top: 8px; right: 8px; z-index: 1; width: 24px; height: 24px; font-size: 14px; padding: 0;">+</button><div class="route-input-group"><label>Point A (origine):</label><div id="selected-point-a" style="display:none; padding: 8px 40px 8px 8px; background: #e3f2fd; border-radius: 4px; margin-bottom: 8px; font-size: 14px; color: #1976d2; position: relative;"><strong>[Point A] </strong><span id="point-a-name"></span><button id="clear-point-a" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); cursor: pointer; background: rgba(211, 47, 47, 0.1); color: #d32f2f; border: 1px solid rgba(211, 47, 47, 0.3); width: 20px; height: 20px; border-radius: 50%; font-size: 12px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: all 0.2s;" title="DÃ©sÃ©lectionner">Ã—</button></div><div class="point-input-container"><div id="geocoder-container"><button id="geolocate" class="geolocate-btn" title="Utiliser ma position"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg></button></div></div></div></div><!-- Point B (destination) - masquÃ© initialement --><div id="point-b-section" class="route-point-section" style="display:none; margin-top:10px;"><div class="route-input-group"><label>Point B (destination):</label><div id="selected-point-b" style="display:none; padding: 8px 40px 8px 8px; background: #fff3cd; border-radius: 4px; margin-bottom: 8px; font-size: 14px; color: #856404; position: relative;"><strong>[Point B] </strong><span id="point-b-name"></span><button id="clear-point-b" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); cursor: pointer; background: rgba(211, 47, 47, 0.1); color: #d32f2f; border: 1px solid rgba(211, 47, 47, 0.3); width: 20px; height: 20px; border-radius: 50%; font-size: 12px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: all 0.2s;" title="DÃ©sÃ©lectionner">Ã—</button></div><div class="point-input-container"><div id="geocoder-container-b"></div></div></div><div class="route-actions"><button id="clear-route-btn" class="route-action-btn secondary">Effacer</button></div></div></div></div></div><!-- Common Elements for Both Modes --><div class="filter-section" id="reset-section" style="display:none;"><button id="reset-map">RÃ©initialiser la carte</button></div><div id="results-count"></div><div id="establishments-view"></div><!-- Panneau dÃ©taillÃ© des instructions de navigation --><div id="route-details-panel" style="display:none; flex-grow:1; overflow-y:auto; margin-top:5px;"><!-- Options de routage avec SWITCHERS --><div id="route-options-container" style="display:none; margin-bottom:10px; padding:10px; border:1px solid #ddd; border-radius:6px; background:#f8f9fa;"><!-- Switcher VÃ©hicule --><div style="display:flex; align-items:center; margin-bottom:8px;"><span style="font-size:11px; font-weight:600; color:#333; margin-right:10px; min-width:50px;">VÃ©hicule:</span><div id="vehicle-switcher" style="
              display:flex; background:#e9ecef; border-radius:20px; padding:2px; cursor:pointer;
              border:1px solid #ced4da; transition:all 0.3s;
            "><div id="vehicle-car" class="switcher-option active" style="
                padding:4px 12px; border-radius:18px; font-size:10px; font-weight:600;
                background:#007bff; color:white; transition:all 0.3s; text-align:center;
              ">ğŸš— Voiture</div><div id="vehicle-truck" class="switcher-option" style="
                padding:4px 12px; border-radius:18px; font-size:10px; font-weight:600;
                background:transparent; color:#6c757d; transition:all 0.3s; text-align:center;
              ">ğŸš› Camion</div></div></div><!-- Switcher PÃ©ages --><div style="display:flex; align-items:center;"><span style="font-size:11px; font-weight:600; color:#333; margin-right:10px; min-width:50px;">PÃ©ages:</span><div id="toll-switcher" style="
              display:flex; background:#e9ecef; border-radius:20px; padding:2px; cursor:pointer;
              border:1px solid #ced4da; transition:all 0.3s;
            "><div id="toll-allow" class="switcher-option active" style="
                padding:4px 12px; border-radius:18px; font-size:10px; font-weight:600;
                background:#28a745; color:white; transition:all 0.3s; text-align:center;
              ">âœ… Avec</div><div id="toll-avoid" class="switcher-option" style="
                padding:4px 12px; border-radius:18px; font-size:10px; font-weight:600;
                background:transparent; color:#6c757d; transition:all 0.3s; text-align:center;
              ">âŒ Sans</div></div></div></div><!-- RÃ©sumÃ© de l'itinÃ©raire --><div id="route-summary" style="background:#002060; color:white; padding:15px; border-radius:8px; margin-bottom:15px; position:relative;"><h3 style="margin:0 0 10px 0; font-size:16px; display:flex; justify-content:space-between; align-items:center;"><span style="color: white;">ğŸ—º RÃ©sumÃ© de l'itinÃ©raire</span><button id="toggle-route-options" style="
              background:rgba(255,255,255,0.2); 
              border:1px solid rgba(255,255,255,0.3); 
              color:white; 
              width:24px; 
              height:24px; 
              border-radius:50%; 
              cursor:pointer; 
              font-size:14px; 
              display:flex; 
              align-items:center; 
              justify-content:center;
              transition:all 0.2s;
              flex-shrink:0;
            " title="Options de routage">âš™ï¸</button></h3><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;"><span id="route-distance" style="font-weight:bold;">--</span><span id="route-duration" style="font-weight:bold;">--</span></div><div id="route-vehicle-info" style="font-size:12px; opacity:0.8; color: white;">Type: Voiture â€¢ PÃ©ages: AutorisÃ©s</div></div><!-- Bouton retour --><div style="margin-top:20px; padding:15px 0; border-top:1px solid #eee;"><button id="back-to-search-btn" class="route-action-btn secondary" style="width:100%;">
            â† Retour Ã  la recherche
          </button></div></div></div><div id="map"><!-- Mode Switcher sur la carte --><div class="mode-switcher-container"><div class="mode-switcher"><button id="mode-normal" class="mode-btn active" data-mode="normal"><span class="mode-icon">ğŸ“</span><span class="mode-label">Carte</span></button><button id="mode-route" class="mode-btn" data-mode="route"><span class="mode-icon">ğŸš—</span><span class="mode-label">ItinÃ©raire</span></button></div></div><!-- LÃ©gende de la carte (overlay sur la carte) --><div class="map-legend" id="map-legend" style="display:block;"><h4>Filtres</h4><div class="legend-items"><div class="legend-item"><div class="legend-marker beton"></div><span>BÃ©ton</span><span class="distance-badge" id="beton-count">0</span></div><div class="legend-item"><div class="legend-marker granulats"></div><span>Granulats</span><span class="distance-badge" id="granulats-count">0</span></div><div class="legend-item"><div class="legend-marker ciment"></div><span>Ciment</span><span class="distance-badge" id="ciment-count">0</span></div><div class="legend-item" id="ciment-prompt-legend" style="display:none;"><div class="legend-marker ciment-prompt"></div><span>Ciment Prompt</span><span class="distance-badge" id="ciment-prompt-count">0</span></div></div></div></div></div><!-- ContrÃ´les de zoom personnalisÃ©s --><div class="custom-zoom-controls"><button class="zoom-btn" id="zoom-in-btn" title="Zoomer" aria-label="Zoomer">+</button><button class="zoom-btn" id="zoom-out-btn" title="DÃ©zoomer" aria-label="DÃ©zoomer">-</button></div><!-- Bouton mobile pour basculer carte/liste --><button class="mobile-toggle-btn" id="mobile-toggle" aria-label="Basculer vue"><svg viewBox="0 0 24 24" fill="currentColor"><path id="mobile-toggle-icon" d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg></button><div id="modal" class="modal"><div class="modal-content"><span class="close-button">Ã—</span><div id="modal-info"></div></div></div>